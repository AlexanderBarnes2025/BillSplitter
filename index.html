<!DOCTYPE html>
<html>
<head>
    <title>Bill Splitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background-color: #f0f0f5;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .person, .inputs, .summary, .results {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin-top: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .add-btn { background-color: #4CAF50; color: white; }
        .calculate-btn { background-color: #2196F3; color: white; }
        .reset-btn { background-color: #FF9800; color: white; }
        .remove-btn {
            background-color: #f44336;
            color: white;
            width: auto;
            padding: 8px 12px;
            margin-top: 5px;
            float: right;
            font-size: 14px;
        }
        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }
        .summary label { font-weight: bold; }
        .results div { padding: 5px 0; }
    </style>
</head>
<body>

<h1>Bill Splitter</h1>

<div class="summary" id="summary">
    <div>Subtotal: $<span id="subtotalDisplay">0.00</span></div>
    <div>Tax: $<span id="taxDisplay">0.00</span></div>
    <div>Tip: $<span id="tipDisplay">0.00</span></div>
    <div><strong>Total: $<span id="totalDisplay">0.00</span></strong></div>
</div>

<div id="payments"></div>

<button class="add-btn" onclick="addPerson()">➕ Add New Person</button>
<button class="reset-btn" onclick="resetAll()">♻️ Reset</button>

<div class="inputs">
    <label>Tax:</label>
    <input type="number" id="tax" min="0" placeholder="Enter tax amount" oninput="updateSummary()">
    <label>Tip:</label>
    <input type="number" id="tip" min="0" placeholder="Enter tip amount" oninput="updateSummary()">
</div>

<button class="calculate-btn" onclick="calculate()">✅ Calculate</button>

<div class="results" id="results"></div>

<script>
    const paymentsDiv = document.getElementById('payments');
    let personCount = 0;

    // Start with 2 people
    addPerson();
    addPerson();

    function addPerson(name='', amount='') {
        personCount++;
        const div = document.createElement('div');
        div.className = 'person clearfix';
        div.id = `person${personCount}`;
        div.innerHTML = `
            <label>Person ${personCount} Name:</label>
            <input type="text" id="name${personCount}" placeholder="Enter name" value="${name}">
            <label>Person ${personCount} Paid:</label>
            <input type="number" id="p${personCount}" min="0" placeholder="Enter amount" value="${amount}" oninput="updateSummary()">
            <button class="remove-btn" onclick="removePerson(${personCount})">Remove</button>
        `;
        paymentsDiv.appendChild(div);
        div.scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateSummary();
    }

    function removePerson(id) {
        const div = document.getElementById(`person${id}`);
        if (div) {
            paymentsDiv.removeChild(div);
        }
        updateSummary();
    }

    function updateSummary() {
        const personDivs = document.querySelectorAll('.person');
        let subtotal = 0;
        personDivs.forEach(div => {
            const id = div.id.replace('person','');
            const amount = parseFloat(document.getElementById(`p${id}`).value) || 0;
            subtotal += amount;
        });
        const tax = parseFloat(document.getElementById('tax').value) || 0;
        const tip = parseFloat(document.getElementById('tip').value) || 0;
        const total = subtotal + tax + tip;

        document.getElementById('subtotalDisplay').innerText = subtotal.toFixed(2);
        document.getElementById('taxDisplay').innerText = tax.toFixed(2);
        document.getElementById('tipDisplay').innerText = tip.toFixed(2);
        document.getElementById('totalDisplay').innerText = total.toFixed(2);
    }

    function calculate() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        const personDivs = document.querySelectorAll('.person');
        if (personDivs.length === 0) {
            alert("Add at least one person to calculate.");
            return;
        }

        let names = [];
        let payments = [];
        let subtotal = 0;

        personDivs.forEach((div, index) => {
            const id = div.id.replace('person','');
            const name = document.getElementById(`name${id}`).value || `Person ${index+1}`;
            const amount = parseFloat(document.getElementById(`p${id}`).value) || 0;
            names.push(name);
            payments.push(amount);
            subtotal += amount;
        });

        if (subtotal === 0) {
            alert("Please enter some payments before calculating.");
            return;
        }

        const tax = parseFloat(document.getElementById('tax').value) || 0;
        const tip = parseFloat(document.getElementById('tip').value) || 0;
        const total = subtotal + tax + tip;

        // Calculate proportional shares with rounding
        let roundedShares = payments.map(p => Math.round((p / subtotal) * total * 100) / 100);

        // Adjust the last person's share to match exact total
        const sumShares = roundedShares.reduce((a,b)=>a+b,0);
        const diff = Math.round((total - sumShares) * 100)/100;
        if(roundedShares.length > 0) {
            roundedShares[roundedShares.length -1] += diff;
        }

        // Display results
        roundedShares.forEach((share, index) => {
            resultsDiv.innerHTML += `<div><strong>${names[index]}:</strong> $${share.toFixed(2)}</div>`;
        });

        updateSummary();
    }

    function resetAll() {
        paymentsDiv.innerHTML = '';
        document.getElementById('tax').value = '';
        document.getElementById('tip').value = '';
        document.getElementById('results').innerHTML = '';
        personCount = 0;
        addPerson();
        addPerson();
        updateSummary();
    }
</script>

</body>
</html>
